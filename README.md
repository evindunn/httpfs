# httpfs
[![TEST](https://github.com/httpfs/httpfs/workflows/TEST/badge.svg?event=push)](https://github.com/httpfs/httpfs/actions?query=workflow%3ATEST)

Network Filesystem over HTTP

**NOTE**: Running the HttpFs client, with or without docker, requires the `fuse`
package to be installed

# Table of Contents
1. [Contributing](./CONTRIBUTING.md)
2. [Code of Conduct](./CODE_OF_CONDUCT.md)
3. [License](./LICENSE)
4. [Design documentation](./docs/)

### Running the server using docker
See [docker-compose.yml](./docker-compose.yml) and the [docker directory](./docker/).
By default the server will run on 8080 and serve up /mnt/httpfs/server with no
API authentication or TLS encryption enabled. Make sure Docker and docker-compose 
are installed. The below commands download the HttpFs docker-compose file and 
start the server.
```shell script
$ wget https://raw.githubusercontent.com/httpfs/httpfs/master/docker-compose.yml
$ docker-compose up httpfs-server
```

### Running the client using docker
See [docker-compose.yml](./docker-compose.yml) and the [docker directory](./docker/).
By default the client will attempt to connected to a server called 
httpfs-server on port 8080. Make sure Docker and docker-compose are installed.
The below commands download the HttpFs docker-compose file and start the client.
```shell script
$ wget https://raw.githubusercontent.com/httpfs/httpfs/master/docker-compose.yml
$ docker-compose up httpfs-client
```

### Running the server without docker
**As the root user**
1. Create the Python environment for HttpFs:
    ```shell script
    $ conda env create -n httpfs_server -f environment.yml
    $ conda activate httpfs_server
    $ pip install -e .
    ```

2. Generate an API key that a client can use to connect:
    ```shell script
    $ ./bin/httpfs-cli add-api-key api-keys.json
    d1d0eb5457f37c3b7823d2d986429ca3
    ```
    Where api-keys.json is the file that will be created or updated with the new 
    API key

3. Start the server:
    ```shell script
    $ python -m httpfs.server 8080 ~/httpfs-test/server --cred-store api-keys.json
    ```
    Where:
      - 8080 is the server port
      - ~/httpfs-test/server is the directory to be exposed to clients
      - api-keys.json is the credential file from step 2

    A client may now connect with `d1d0eb5457f37c3b7823d2d986429ca3`, the API
    key generated in step 2

### Running the client without docker
**As the root user**
1. Create the Python environment for HttpFs:
    ```shell script
    $ conda env create -n httpfs_server -f environment.yml
    $ conda activate httpfs_server
    $ pip install -e .
    ```

2. Run the client:
    ```shell script
    python -m httpfs.client 127.0.0.1:8080 /mnt/httpfs/client --api-key d1d0eb5457f37c3b7823d2d986429ca3
    ```
    Where: 
      - 127.0.0.1:8080 is the address of an HttpFs server 
      - /mnt/httpfs/client is where HttpFs will be mounted
      - api-key is a string generated by `httpfs-cli add-api-key` on an HttpFs server

### Adding TLS Encryption
HttpFS provides a utility for create self-signed https certificates to encrypt
communication between and HttpFS client and server

1. Generate the certificates: `./bin/httpfs-cli gen-certs` will create `ca.key`,
`ca.crt`, `server.key`, and `server.crt` after prompting for some identifying
information:
    ```shell script
    $ ./bin/httpfs-cli gen-certs
    Country: US
    State: AZ
    City/Locality: Flagstaff
    CA private key written to ca.key
    CA certificate written to ca.crt
    Server private key written to ca.key
    Server certificate written to server.crt
    ```

2. Start the server with TLS:
    ```shell script
    $ python -m httpfs.server 8080 /mnt/httpfs/server --tls-key server.key --tls-cert server.crt
    ```
   
3. Copy `ca.crt` to the client

4. Start the client, adding the generated CA as a trusted authority
    ```shell script
    $ python -m httpfs.client 127.0.0.1:8080 /mnt/httpfs/client --ca-file ca.crt
    ```

---
Organization Icon: File Server by I Putu Kharismayadi from the Noun Project
